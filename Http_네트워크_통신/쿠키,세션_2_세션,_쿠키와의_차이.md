# 세션(Session)

: 일정시간동안(브라우저 사용 중일 동안) 한 사용자(브라우저)의 상태를 유지시키는 것(**클라이언트를 구분하는 수단**).

* **쿠키**를 기반하고 있지만, 쿠키와 차이점이 존재.
* 쿠키는 **브라우저**나 하드에 저장하는데, 세션은 **웹 서버**에 저장함.
  * **Session Id**(세션 키값. 개발자 도구에서 **JSESSIONID**)는 쿠키로 저장하고, 필요할 때마다 서버에 저장된 데이터를 이 키로 받아옴
  * 서버 처리를 필요로 해, 무분별하게 사용하면 성능 저하될 수 있음
* HTTP 프로토콜에서 Req, Res가 오고가면 연결이 끊어지는데, 정보를 유지하려면 이 세션이라는 것이 필요
* 클라이언트가 Req를 보내면 서버의 엔진이 클라이언트에게 유일한 ID를 부여해줌.



### JWT: 세션은 서버 처리를 필요로 하기 때문에 최근 JWT라는 토큰 기반 인증 방식을 사용



## 세션의 절차

1. 클라이언트가 서버에 리소스 요청하면 HTTP 헤더의 쿠키에서 Session Id를 확인
   * 이 때 없으면 Set-Cookie를 통해 새로 발행한 Session Id를 보낸다.
2. 클라이언트는 세션 Id를 쿠키로 저장하고, 다시 리소스 요청 시 HTTP request 헤더에 Session Id를 포함하여 원하는 리소스를 요청
3. 서버는 클라이언트마다 구분이 되는 이 Session Id를 통해 세션을 찾아 클라이언트의 상태 정보를 유지하면서 적절한 응답을 보냄

![img](https://media.vlpt.us/images/junhok82/post/eb016f92-dfe1-4961-a7ea-f5501352b3d9/image.png)

* 출처 : https://velog.io/@junhok82/%EB%A1%9C%EA%B7%B8%EC%9D%B8%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9D%B4%EB%A3%A8%EC%96%B4%EC%A7%88%EA%B9%8CCookie-Session



## 세션의 장단점

* 장점
  * 클라이언트마다 고유의 id가 있다.
    * 각 클라이언트의 요구에 맞는 서비스 제공 가능
  * 정보를 서버에 저장하기 때문에 쿠키의 보안상 단점을 커버
* 단점
  * 서버에 별도 저장 공간 필요. 동접자가 많은 경우에 성능 저하의 요인이 될 수 있음
  * LB 상황에서도 처리하기 어렵다고 함.
    * 이 때는 1. 세션정보는 하나의 서버에만 저장하거나, 2. 별도 DB를 사용해서 scale된 서버들끼리 Session을 공유하도록?
  * **CORS**
    * 세션 관리 시 단일 도메인 및 서브 도메인에서만 작동하도록 되어있어,여러 도메인에서 관리하는 것은 번거롭다고 함



## 세션과 쿠키 차이

|                           | **쿠키(Cookie)**                                             | **세션(Session)**                                            |
| ------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **저장 위치**             | 클라이언트(=접속자 PC)                                       | 웹 서버                                                      |
| **저장 형식**             | text                                                         | Object                                                       |
| **만료 시점**             | **쿠키 저장시 설정<br />(브라우저가 종료되어도,<br />만료시점이 지나지 않으면 자동삭제되지 않음)** | **브라우저 종료시 삭제<br />(브라우저 유지 중에도,<br />expire 기한 지정을 할수는 있음)** |
| **사용하는 자원(리소스)** | 클라이언트 리소스                                            | 웹 서버 리소스                                               |
| **용량 제한**             | 총 300개<br />하나의 도메인 당 20개<br />하나의 쿠키 당 4KB(=4096byte) | 서버가 허용하는 한 용량제한 없음.                            |
| **속도**                  | 세션보다 빠름                                                | 쿠키보다 느림<br />(서버의 처리가 필요하기 때문)             |
| **보안**                  | 세션보다 안좋음<br />(request 중 스니핑 당할 우려)           | 쿠키보다 좋음<br />(sessionId만 저장하고,<br />실제 세션은 서버에 저장하기 때문) |

#### 출처: https://hahahoho5915.tistory.com/32 [넌 잘하고 있어]



#### Reference)

#### https://velog.io/@junhok82/%EB%A1%9C%EA%B7%B8%EC%9D%B8%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9D%B4%EB%A3%A8%EC%96%B4%EC%A7%88%EA%B9%8CCookie-Session

#### https://hahahoho5915.tistory.com/32

#### https://interconnection.tistory.com/74

#### https://nesoy.github.io/articles/2017-03/Session-Cookie

#### https://tristan91.tistory.com/521